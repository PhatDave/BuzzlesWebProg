{% load static %}

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>{{ title }}</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<script src="https://kit.fontawesome.com/3c7df30b74.js" crossorigin="anonymous"></script>
		<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
		<link rel="stylesheet" href="{% static 'main/css/main.css' %}">
	</head>
    <body>
        {% block body %}
        {% endblock %}
        <script>
{#        TODO: Move the following into register, it does not belong here #}
            $(document).ready(function() {
                const emailField = $("#email");
                const invalidEmailElement = $(".invalidEmail")

                emailField.keyup(function() {
                    let email = $(this).val();
                    emailValidator.Validate(email);
                })

                emailField.change(function() {
                    let email = $(this).val();
                    emailValidator.Validate(email);
                })

                class IValidator {
                    static invalidFieldElement = invalidEmailElement;

                    constructor() {
                        this.next = null;
                    }

                    Validate(email) {
                        if (this.ValidateLength(email)) {
                            this.ConcreteValidate(email);
                        }
                    }
                    ConcreteValidate(email) {}

                    AddValidator(validator) {
                        if (this.next == null) {
                            this.next = validator;
                        } else {
                            this.next.AddValidator(validator);
                        }
                    }

                    DisplayElement(text) {
                        IValidator.invalidFieldElement.removeClass("d-none");
                        IValidator.invalidFieldElement.text(text);
                    }

                    HideElement() {
                        IValidator.invalidFieldElement.addClass("d-none");
                        IValidator.invalidFieldElement.text("");
                    }

                    NextValidate(email) {
                        if (this.next != null) {
                            this.next.Validate(email);
                        }
                    }

                    ValidateLength(email) {
                        if (email.length == 0) {
                            this.HideElement();
                            return false
                        }
                        return true
                    }

                    Contains(email, substr, message) {
                        if (email.indexOf(substr) == -1) {
                            this.DisplayElement(message);
                        } else {
                            this.HideElement();
                            this.NextValidate(email);
                        }
                    }

                    Count(email, substr, index, message) {
                        if (email.split(substr)[index].length == 0) {
                            this.DisplayElement(message);
                        } else {
                            this.HideElement();
                            this.NextValidate(email)
                        }
                    }
                }
                class AtValidator extends IValidator {
                    ConcreteValidate(email) {
                        this.Contains(email, "@", "Email must contain a @")
                    }
                }
                class AtLengthValidatorLeft extends IValidator {
                    ConcreteValidate(email) {
                        this.Count(email, "@", 0, "Email must contain at least 1 character before @");
                    }
                }
                class AtLengthValidatorRight extends IValidator {
                    ConcreteValidate(email) {
                        this.Count(email, "@", 1, "Email must contain at least 1 character after @");
                    }
                }
                class DotValidator extends IValidator {
                    ConcreteValidate(email) {
                        this.Contains(email, ".", "Email must contain a .")
                    }
                }
                class DotLengthValidatorLeft extends IValidator {
                    ConcreteValidate(email) {
                        this.Count(email, ".", 0, "Email must contain at least 1 character before .");
                    }
                }
                class DotLengthValidatorRight extends IValidator {
                    ConcreteValidate(email) {
                        this.Count(email, ".", 1, "Email must contain at least 1 character after .");
                    }
                }

                class EmailValidator {
                    constructor() {
                        this.validator = null;

                        this.validator = new AtValidator();
                        this.validator.AddValidator(new AtLengthValidatorLeft())
                        this.validator.AddValidator(new AtLengthValidatorRight())
                        this.validator.AddValidator(new DotValidator())
                        this.validator.AddValidator(new DotLengthValidatorLeft())
                        this.validator.AddValidator(new DotLengthValidatorRight())
                    }

                    Validate(email) {
                        this.validator.Validate(email);
                    }
                }
                const emailValidator = new EmailValidator();

                $("#password").keypress(function() {
                    console.log($(this).val());
                })
            })

            {% block scirpt %}
            {% endblock %}
        </script>
    </body>
</html>